(function(m){function t(a){if(k.call(this,a,"fill")){var d=a.__repeater;if(null!=d.prefill){var b=d.prefill.call(this,a);if(null!=b&&!b){h.call(this,a,"fill");return}}null!=d.fill?d.fill.call(this,a,{callback:u}):u.call(this,a,data,!0)}}function u(a,d,b){h.call(this,a,"fill");var c=a.__repeater;if(null==b||b){if(!c.fieldfixed)c.field.length=0;if(null!=d){if(null!=d.itemcount)c.itemcount=new Number(d.itemcount),c.pagecount=Math.ceil(c.itemcount/c.pagesize),d.pagecount=c.pagecount,d.pageindex=c.pageindex,
d.pagesize=c.pagesize;c.inserteditemcount=0;c.updateditemcount=0;c.removeditemcount=0;if(!c.fieldfixed){var e=d[c.setting.rowsname];if(null!=e||e.length!=0)for(var f in e[0])c.field.push(f)}}l.call(this,a,d);null!=c.filled&&c.filled.call(this,a,{data:d,isSuccess:b});null!=c.navigable&&c.navigable.call(this,a,{prev:c.pageindex>1,next:c.pageindex<c.pagecount})}}function l(a,d){var b=a.__repeater,c="",e=!1;b.data=d;c+=b.template.header;c+=b.template.newitem;if(null==d)e=!0;else{var f=d[b.setting.rowsname];
if(null==f||f.length==0)e=!0;else try{for(var g="",h="",l="",j=0;j<f.length;j++){var i=f[j];if(null!=i){if(null==i.__state)i.__state="unchanged";if(null==i.__selected)i.__selected=!1;if(null==i.__editing)i.__editing=!1;var k;k=i.__editing&&b.template.edititem!=""?b.template.edititem:i.__state=="inserted"&&b.template.inserteditem!=""?b.template.inserteditem:i.__state=="removed"?b.template.removeditem:i.__state=="updated"&&b.template.updateditem!=""?b.template.updateditem:b.template.item;k=k.replace(m.fn.__repeater.regExps.tag,
function(a,c,d){if(null==d||d=="")return"";if(c=="id")return c+'="'+d.toString()+"_"+j.toString()+'"';else if(c=="class")return c+'="'+d.toString().replace("{state}",i.__state.toString())+'"';else if(c=="checked"){if(d=="selected"&&i.__selected)return c+'="checked"'}else return c.indexOf("on")==0?(a=d.split(","),c+"=\"$('"+b.selector+"').__repeater('"+a[0]+"', #{__index}"+(a.length<2||a[1]==""?"":", '"+a[1].toString()+"'")+');"'):c+'="'+d.toString()+'"'}).replace(m.fn.__repeater.regExps.field,function(a,
b){return null==b||b==""?"":b=="__index"?j.toString():null==i[b]?"":i[b]});i.__state=="inserted"?g+=k:i.__state=="removed"?h+=k:l+=k}}c+=g+l+h}catch(n){e=!0}}e&&(c+=b.template.empty);c+=b.template.footer;c=c.replace(m.fn.__repeater.regExps.tag,function(a,c,d){return null==d||d==""?"":c=="id"?c+'="'+d.toString()+'_"':c.indexOf("on")==0?(a=d.split(","),c+"=\"$('"+b.selector+"').__repeater('"+a[0]+"'"+(a.length<2||a[1]==""?"":", '"+a[1].toString()+"'")+(a.length<3||a[2]==""?"":", '"+a[2].toString()+
"'")+(a.length<4||a[3]==""?"":", '"+a[3].toString()+"'")+');"'):c+'="'+d.toString()+'"'}).replace(m.fn.__repeater.regExps.attribute,function(a,b){return null==b||b==""?"":null==d[b]?"":d[b]});this.html(c)}function j(a,d,b,c){a=a.__repeater;null==a.data||null==a.data[a.setting.rowsname]||(a.data[a.setting.rowsname][d]["__"+b]=c)}function o(a,d,b){a=a.__repeater;return null==a.data||null==a.data[a.setting.rowsname]?void 0:a.data[a.setting.rowsname][d]["__"+b]}function p(a,d,b){if(o.call(this,a,d,"state")!=
"removed"){var c=a.__repeater;if(b=null==b?!o.call(this,a,d,"selected"):b?!0:!1)!c.multipleselect&&null!=c.index.select&&j.call(this,a,c.index.select,"selected",!1),c.index.select=d;j.call(this,a,d,"selected",b);l.call(this,a,c.data)}}function q(a,d){var b=a.__repeater;if(null!=b.data&&b.multipleselect){var c=b.data[b.setting.rowsname];if(!(null==c||c.length==0)){for(var e=0;e<c.length;e++){var f=c[e];if(!(null==f||f.__state=="removed"))f.__selected=null==d?!f.__selected:d?!0:!1}l.call(this,a,b.data)}}}
function v(a,d,b){var c=a.__repeater,e=n.call(this,a,d);if(e.__state!="removed"&&(null!=b||k.call(this,a,"remove"))){if(null==b&&null!=c.preremove){var f=c.preremove.call(this,a,{index:d,row:e});if(null!=f&&!f){h.call(this,a,"remove");return}}null!=c.remove?c.remove.call(this,a,{index:d,row:e,substep:b,callback:w}):w.call(this,a,d,e,!0,b)}}function w(a,d,b,c,e){b=a.__repeater;null==e?h.call(this,a,"remove"):(e.completed++,null!=b.substepping&&b.substepping.call(this,a,{substep:e}),e.completed==e.count&&
(h.call(this,a,"removeselected"),null!=b.substepped&&b.substepped.call(this,a,{substep:e})));if(null==c||c)if(!(null==b.data||null==b.data[b.setting.rowsname])){if(null!=b.itemcount)b.itemcount--,b.inserteditemcount++,b.data.itemcount=b.itemcount,b.pagecount=Math.ceil(b.itemcount/b.pagesize),b.data.pagecount=b.pagecount;j.call(this,a,d,"state","removed");j.call(this,a,d,"editing",!1);j.call(this,a,d,"selected",!1);if(null==e||e.completed==e.count)l.call(this,a,b.data),null!=b.navigable&&b.navigable.call(this,
a,{prev:b.pageindex>1,next:b.pageindex<b.pagecount});null==e&&null!=b.removed&&b.removed.call(this,a,{index:d,isSuccess:c})}}function x(a,d,b,c){h.call(this,a,"update");if(null==c||c){var e=a.__repeater;r.call(this,a,d,b);e.updateditemcount++;j.call(this,a,d,"state","updated");j.call(this,a,d,"editing",!1);l.call(this,a,e.data);null!=e.updated&&e.updated.call(this,a,{index:d,row:b,isSuccess:c})}}function y(a,d,b){h.call(this,a,"insert");if(null==b||b){var c=a.__repeater;if(!(null==c.data||null==c.data[c.setting.rowsname])){c.data[c.setting.rowsname].push(d);
if(null!=c.itemcount)c.itemcount++,c.removeditemcount++,c.data.itemcount=c.itemcount,c.pagecount=Math.ceil(c.itemcount/c.pagesize),c.data.pagecount=c.pagecount;d.__state="inserted";d.__selected=!1;d.__editing=!1;l.call(this,a,c.data);null!=c.inserted&&c.inserted.call(this,a,{row:d,isSuccess:b});null!=c.navigable&&c.navigable.call(this,a,{prev:c.pageindex>1,next:c.pageindex<c.pagecount})}}}function z(a,d,b,c){var e=n.call(this,a,d),f=a.__repeater;if(e.__state!="removed"&&(null!=c||k.call(this,a,"custom"))){if(null==
c&&null!=f.precustom){var g=f.precustom.call(this,a,{index:d,command:b,row:e});if(null!=g&&!g){h.call(this,a,"custom");return}}null!=f.custom?f.custom.call(this,a,{index:d,command:b,row:e,substep:c,callback:A}):A.call(this,a,d,b,e,!0,c)}}function A(a,d,b,c,e,f){var g=a.__repeater;null==f?h.call(this,a,"custom"):(f.completed++,null!=g.substepping&&g.substepping.call(this,a,{substep:f}),f.completed==f.count&&(h.call(this,a,"customselected"),null!=g.substepped&&g.substepped.call(this,a,{substep:f})));
if(null==e||e)r.call(this,a,d,c),g.updateditemcount++,j.call(this,a,d,"state","updated"),(null==f||f.completed==f.count)&&l.call(this,a,g.data),null==f&&null!=g.customed&&g.customed.call(this,a,{index:d,command:b,row:c,isSuccess:e})}function n(a,d){var b=a.__repeater,c={},e;if(null!=b.data&&null!=b.data[b.setting.rowsname]&&(e=b.data[b.setting.rowsname][d],null!=e))c.__state=e.__state,c.__selected=e.__selected,c.__editing=e.__editing;for(var f=0;f<b.field.length;f++){var g=m("#"+b.field[f]+"_"+(null==
d?"":d.toString()));g.length!=0?c[b.field[f]]=g.val():null!=e&&(c[b.field[f]]=e[b.field[f]])}return c}function r(a,d,b,c){if(!(null==d||null==b)){var e=a.__repeater;if(null!=e.data){var f=e.data[e.setting.rowsname];if(null!=f){for(var g in b)f[d][g]=b[g];null!=c&&c&&l.call(this,a,e.data)}}}}function s(a,d){var b=a.__repeater;if(d<=0)d=1;else if(null!=b.pagecount&&d>b.pagecount)d=b.pagecount;b.pageindex=d;t.call(this,a)}function k(a,d){var b=a.__repeater;if(b.singlethread&&b.busy)return null!=b.blocked&&
b.blocked.call(this,a,{action:d}),!1;b.busy=!0;null!=b.preexecute&&b.preexecute.call(this,a,{action:d});return!0}function h(a,d){var b=a.__repeater;b.busy=!1;null!=b.executed&&b.executed.call(this,a,{action:d})}m.fn.__repeater=function(){if(this.length==0)return this;var a=this.get(0),d="create";if(typeof arguments[0]=="string"){if(null==a.__repeater)return this;d=arguments[0]=="option"?arguments.length==2?"get":"set":"method"}else arguments[0]=m.extend({},m.fn.__repeater.defaults,arguments[0]);switch(d){case "get":return a.__repeater[arguments[1]];
case "set":return a.__repeater[arguments[1]]=arguments[2];case "method":switch(arguments[0]){case "fill":t.call(this,a);break;case "bind":l.call(this,a,arguments[1]);break;case "beginedit":d=arguments[1];if(o.call(this,a,d,"state")!="removed"){var b=a.__repeater;!b.multipleedit&&null!=b.index.edit&&j.call(this,a,b.index.edit,"editing",!1);b.index.edit=d;j.call(this,a,d,"editing",!0);l.call(this,a,b.data)}break;case "endedit":d=arguments[1];if(o.call(this,a,d,"state")!="removed")b=a.__repeater,j.call(this,
a,d,"editing",!1),l.call(this,a,b.data);break;case "select":p.call(this,a,arguments[1],!0);break;case "unselect":p.call(this,a,arguments[1],!1);break;case "toggleselect":p.call(this,a,arguments[1]);break;case "selectall":q.call(this,a,!0);break;case "unselectall":q.call(this,a,!1);break;case "toggleselectall":q.call(this,a);break;case "remove":v.call(this,a,arguments[1]);break;case "removeselected":a:{var c=a.__repeater;if(null!=c.data&&(d=c.data[c.setting.rowsname],!(null==d||d.length==0))){for(var b=
{action:"removeselected",count:0,completed:0},e=0;e<d.length;e++){var f=d[e];null!=f&&f.__selected&&f.__state!="removed"&&b.count++}if(b.count!=0&&k.call(this,a,"removeselected")){if(null!=c.presubstep&&(c=c.presubstep.call(this,a,{substep:b}),null!=c&&!c)){h.call(this,a,"removeselected");break a}for(e=0;e<d.length;e++)f=d[e],null!=f&&f.__selected&&f.__state!="removed"&&v.call(this,a,e,b)}}}break;case "update":a:if(d=arguments[1],b=a.__repeater,c=n.call(this,a,d),c.__state!="removed"&&k.call(this,
a,"update")){if(null!=b.preupdate&&(e=b.preupdate.call(this,a,{index:d,row:c}),null!=e&&!e)){h.call(this,a,"update");break a}null!=b.update?b.update.call(this,a,{index:d,row:c,callback:x}):x.call(this,a,d,c,!0)}break;case "insert":a:if(d=a.__repeater,b=n.call(this,a),k.call(this,a,"insert")){if(null!=d.preinsert&&(c=d.preinsert.call(this,a,{row:b}),null!=c&&!c)){h.call(this,a,"insert");break a}null!=d.insert?d.insert.call(this,a,{row:b,callback:y}):y.call(this,a,b,!0)}break;case "custom":z.call(this,
a,arguments[1],arguments[2]);break;case "customselected":a:if(d=arguments[1],e=a.__repeater,null!=e.data&&(b=e.data[e.setting.rowsname],!(null==b||b.length==0))){c={action:"customselected",count:0,completed:0};for(f=0;f<b.length;f++){var g=b[f];null!=g&&g.__selected&&g.__state!="removed"&&c.count++}if(c.count!=0&&k.call(this,a,"customselected")){if(null!=e.presubstep&&(e=e.presubstep.call(this,a,{substep:c}),null!=e&&!e)){h.call(this,a,"customselected");break a}for(f=0;f<b.length;f++)g=b[f],null!=
g&&g.__selected&&g.__state!="removed"&&z.call(this,a,f,d,c)}}break;case "setrow":r.call(this,a,arguments[1],arguments[2],arguments[3]);break;case "getrow":n.call(this,a,arguments[1]);break;case "goto":s.call(this,a,arguments[1]);break;case "prev":s.call(this,a,a.__repeater.pageindex-1);break;case "next":s.call(this,a,a.__repeater.pageindex+1)}return this;default:return arguments[0].selector=this.selector,arguments[0].pageindex=null==arguments[0].pageindex||arguments[0].pageindex<=0?1:arguments[0].pageindex,
arguments[0].pagesize=null==arguments[0].pagesize||arguments[0].pagesize<=0?10:arguments[0].pagesize,arguments[0].template={header:null==arguments[0].header?"":arguments[0].header,footer:null==arguments[0].footer?"":arguments[0].footer,item:null==arguments[0].item?"":arguments[0].item,edititem:null==arguments[0].edititem?"":arguments[0].edititem,empty:null==arguments[0].empty?"":arguments[0].empty,newitem:null==arguments[0].newitem?"":arguments[0].newitem,inserteditem:null==arguments[0].inserteditem?
"":arguments[0].inserteditem,updateditem:null==arguments[0].updateditem?"":arguments[0].updateditem,removeditem:null==arguments[0].removeditem?"":arguments[0].removeditem},arguments[0].setting={rowsname:null==arguments[0].rowsname?"rows":arguments[0].rowsname},arguments[0].index={edit:arguments[0].editindex,select:arguments[0].selectindex},arguments[0].multipleedit=null==arguments[0].multipleedit?!1:arguments[0].multipleedit,arguments[0].multipleselect=null==arguments[0].multipleselect?!0:arguments[0].multipleselect,
arguments[0].fieldfixed=null!=arguments[0].field,arguments[0].field=null==arguments[0].field?[]:arguments[0].field,a.__repeater=arguments[0],this}};m.fn.__repeater.encodeData=function(){for(var a="",d=0;d<arguments.length;d++){var b=arguments[d];if(null!=b)for(var c in b)a!=""&&(a+=","),a+='"'+c.toString()+'": '+(null==b[c]?"null":'"'+b[c].toString()+'"')}return"{"+a+"}"};m.fn.__repeater.regExps={tag:/je-([^=]+)="([^\"]*)\"/g,field:/#{([^}]*)}/g,attribute:/\@{([^}]*)}/g};m.fn.__repeater.defaults=
{selector:null,pagesize:10,pageindex:1,pagecount:null,itemcount:null,inserteditemcount:0,updateditemcount:0,deleteditemcount:0,field:null,fieldfixed:null,header:null,footer:null,item:null,edititem:null,inserteditem:null,updateditem:null,removeditem:null,empty:null,newitem:null,rowsname:"rows",editindex:null,multipleedit:!1,selectindex:null,multipleselect:!0,prefill:null,fill:null,filled:null,preremove:null,remove:null,removed:null,preupdate:null,update:null,updated:null,preinsert:null,insert:null,
inserted:null,navigable:null,busy:!1,blocked:null,singlethread:!0,preexecute:null,executed:null,precustom:null,custom:null,customed:null,presubstep:null,substepping:null,substepped:null}})(jQuery);
